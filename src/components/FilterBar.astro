---
interface Props {
  domains: string[];
  stacks: string[];
  years: string[];
}

const { domains, stacks, years } = Astro.props;
---

<div class="filter-bar">
  {domains.length > 0 && (
    <div class="filter-group">
      <span class="filter-label">Domain</span>
      <div class="filter-buttons" data-filter-group="domain">
        <button class="filter-btn active" data-value="">All</button>
        {domains.map(domain => (
          <button class="filter-btn" data-value={domain}>{domain}</button>
        ))}
      </div>
    </div>
  )}
  {stacks.length > 0 && (
    <div class="filter-group">
      <span class="filter-label">Stack</span>
      <div class="filter-buttons" data-filter-group="stack">
        <button class="filter-btn active" data-value="">All</button>
        {stacks.map(stack => (
          <button class="filter-btn" data-value={stack}>{stack}</button>
        ))}
      </div>
    </div>
  )}
  {years.length > 0 && (
    <div class="filter-group">
      <span class="filter-label">Year</span>
      <div class="filter-buttons" data-filter-group="year">
        <button class="filter-btn active" data-value="">All</button>
        {years.map(year => (
          <button class="filter-btn" data-value={year}>{year}</button>
        ))}
      </div>
    </div>
  )}
</div>

<script>
  let activeDomain = '';
  let activeStack = '';
  let activeYear = '';

  function updateCards() {
    const cards = document.querySelectorAll<HTMLElement>('.card-item');
    cards.forEach(card => {
      const cardDomain = card.dataset.domain ?? '';
      const cardStacks = card.dataset.stack ? card.dataset.stack.split(',') : [];
      const cardYear = card.dataset.year ?? '';
      const domainMatch = !activeDomain || cardDomain === activeDomain;
      const stackMatch = !activeStack || cardStacks.includes(activeStack);
      const yearMatch = !activeYear || cardYear === activeYear;
      card.style.display = domainMatch && stackMatch && yearMatch ? '' : 'none';
    });
  }

  document.querySelectorAll<HTMLButtonElement>('[data-filter-group="domain"] .filter-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('[data-filter-group="domain"] .filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      activeDomain = btn.dataset.value ?? '';
      updateCards();
    });
  });

  document.querySelectorAll<HTMLButtonElement>('[data-filter-group="stack"] .filter-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('[data-filter-group="stack"] .filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      activeStack = btn.dataset.value ?? '';
      updateCards();
    });
  });

  document.querySelectorAll<HTMLButtonElement>('[data-filter-group="year"] .filter-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('[data-filter-group="year"] .filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      activeYear = btn.dataset.value ?? '';
      updateCards();
    });
  });
</script>

<style>
  .filter-bar {
    display: flex;
    flex-direction: column;
    gap: 0.6rem;
    margin-bottom: 2rem;
    padding: 1rem 1.25rem;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
  }

  .filter-group {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .filter-label {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-secondary);
    min-width: 2.5rem;
    flex-shrink: 0;
  }

  .filter-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 0.35rem;
  }

  .filter-btn {
    display: inline-block;
    padding: 0.2rem 0.65rem;
    border-radius: 20px;
    font-size: 0.78rem;
    font-weight: 600;
    background: transparent;
    color: var(--text-secondary);
    border: 1px solid var(--border);
    cursor: pointer;
    transition: all var(--transition);
    white-space: nowrap;
  }

  .filter-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
  }

  .filter-btn.active {
    background: var(--accent-dim);
    color: var(--accent);
    border-color: rgba(0, 217, 255, 0.3);
  }
</style>
