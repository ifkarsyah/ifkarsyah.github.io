---
import BaseLayout from '../layouts/BaseLayout.astro';
import ProjectCard from '../components/ProjectCard.astro';
import BlogCard from '../components/BlogCard.astro';

const projectFiles = import.meta.glob('../content/projects/*.md', { eager: true });
const featuredProjects = Object.entries(projectFiles)
  .map(([path, mod]: [string, any]) => ({
    ...mod.frontmatter,
    slug: path.split('/').pop()!.replace('.md', ''),
  }))
  .filter((p: any) => p.featured)
  .sort((a: any, b: any) => new Date(b.date).getTime() - new Date(a.date).getTime())
  .slice(0, 3);

const postFiles = import.meta.glob('../content/blog/**/index.md', { eager: true });
const recentPosts = Object.entries(postFiles)
  .map(([path, mod]: [string, any]) => ({
    ...mod.frontmatter,
    slug: path.split('/').slice(-2, -1)[0],
  }))
  .sort((a: any, b: any) => new Date(b.pubDate).getTime() - new Date(a.pubDate).getTime())
  .slice(0, 3);
---

<BaseLayout pageTitle="Home" description="ifkarsyah — Software Engineer specializing in data platform and infrastructure engineering.">

  <!-- Hero -->
  <section class="hero">
    <div class="hero-content">
      <div class="hero-text">
        <p class="hero-label">Hey, I'm</p>
        <h1 class="hero-name">ifkarsyah</h1>
        <p class="hero-subtitle">Software Engineer on data platform and infrastructure. I build pipelines, query engines, and the systems that keep data reliable at scale. Python, SQL, Spark, Flink, ClickHouse — and occasionally I blog about it.</p>
        <div class="hero-cta">
          <a href="/Ferdian_Ifkarsyah___Resume___2025___11____DE.pdf" download class="btn btn-outline">Download Resume</a>
        </div>
      </div>
      <div class="hero-photo">
        <img src="/photo.png" alt="ifkarsyah" />
      </div>
    </div>
  </section>

  <!-- Featured Projects -->
  {featuredProjects.length > 0 && (
    <section class="section">
      <div class="section-header">
        <p class="section-title">Featured Projects</p>
        <a href="/projects/" class="section-link">All projects →</a>
      </div>
      <div class="cards-grid">
        {featuredProjects.map((project: any) => (
          <ProjectCard
            title={project.title}
            description={project.description}
            tags={project.tags}
            slug={project.slug}
            featured={project.featured}
            link={project.link}
          />
        ))}
      </div>
    </section>
  )}

  <!-- Recent Posts -->
  {recentPosts.length > 0 && (
    <section class="section">
      <div class="section-header">
        <p class="section-title">Recent Posts</p>
        <a href="/blog/" class="section-link">All posts →</a>
      </div>
      <div class="cards-grid">
        {recentPosts.map((post: any) => (
          <BlogCard
            title={post.title}
            description={post.description}
            pubDate={post.pubDate}
            tags={post.tags}
            slug={post.slug}
            author={post.author}
          />
        ))}
      </div>
    </section>
  )}

</BaseLayout>

<style>
  /* Hero */
  .hero {
    padding: 3rem 0 3.5rem;
    border-bottom: 1px solid var(--border);
    margin-bottom: 3rem;
  }

  .hero-content {
    display: flex;
    align-items: center;
    gap: 3rem;
  }

  .hero-text {
    flex: 1;
  }

  .hero-photo {
    flex-shrink: 0;
  }

  .hero-photo img {
    width: 200px;
    height: 200px;
    border-radius: 50%;
    object-fit: cover;
    object-position: center top;
    border: 3px solid var(--border);
  }

  .hero-label {
    font-size: 0.9rem;
    color: var(--accent);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 0.5rem;
  }

  .hero-name {
    font-size: 3rem;
    font-weight: 800;
    color: var(--text-primary);
    margin-bottom: 1rem;
    line-height: 1.1;
  }

  .hero-subtitle {
    font-size: 1.1rem;
    color: var(--text-secondary);
    max-width: 55ch;
    line-height: 1.7;
    margin-bottom: 1.75rem;
  }

  .hero-cta {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  /* Section header with link */
  .section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1.25rem;
  }

  .section-header .section-title {
    margin-bottom: 0;
  }

  .section-link {
    font-size: 0.875rem;
    color: var(--text-secondary);
    transition: color var(--transition);
  }

  .section-link:hover {
    color: var(--accent);
    opacity: 1;
  }

  @media (max-width: 640px) {
    .hero-content {
      flex-direction: column-reverse;
      gap: 1.5rem;
    }

    .hero-photo img {
      width: 140px;
      height: 140px;
    }

    .hero-name {
      font-size: 2.25rem;
    }

    .hero-subtitle {
      font-size: 1rem;
    }
  }
</style>
